---
title: "NormVAE Model on NeuroImaging data: Paper Implementation"
excerpt: "Implementation of the paper: “NormVAE: Normative modeling on NeuroImaging data using Variational Autoencoders”. I trained the model with our own custom dataset of MCI/AD patient data from ADNI. Generated the deviation maps for studying how much the diseased brain region volumes deviate from that of Healthy Controls..  <br/><img src='/images/normvae.png'>"
collection: portfolio
---

# NormVAE Paper Implementation
Paper link: [Link to the NormVAE paper](https://arxiv.org/pdf/2110.04903.pdf)

GitHub Link : [Link to the GitHub Repo](https://github.com/sandeshkatakam/NormVAE-Neuroimaging) 

# NormVAE Paper Implementation
Paper link: [Link to the NormVAE paper](https://arxiv.org/pdf/2110.04903.pdf)

Implementation of NormVAE Paper using PyTorch Framework on Custom Dataset(ADNI Dataset).


<img src="images/normvae.png" alt="drawing" width="400" class = "center"/>
Source : NormVAE: Normative Modelling on Neuroimaging Data using Variational Autoencoders paper, Fig. 1

## Usage:

### Installing Dependencies:
```python
pip install -r requirements.txt
```

The following packages will be installed : 
* PyTorch
* Numpy
* Pandas
* Scikit-Learn
### Data Preprocessing Step:
```python
python data_preprocessing.py --path "/path/to/dataset" --bsize #batchsize
```

* An example:  
```python
python data_preprocessing.py --path "dataset.xlsx" --bsize 64
```

### Training the Model: (step by step process) 
* Download the code from the repository and get the dataset file or modify the dimensions in the code for your dataset.  
* After downloading the repository from the terminal go to the directory and Install depedencies using : 
```python
pip install -r requirements.txt
```
* Preprocess data using the data preprocessing script
```python
python data_preprocessing.py --path "/path/to/dataset" --bsize #batchsize
```

* To generate the reconstructed samples along with training the model:
  * number of samples can be given using --gensamples
```python
python reconstruct.py --bsize #batchsize --epochs #epochs --gensamples #no.ofsamples --output_format {outputformat as string} 
```

### An example usage :
#### Only For Training the Model
```python
python data_preprocessing.py --path "dataset.xlsx" --bsize 64

python train_model.py --epochs 1000 --bsize 1024
```
#### For Training the Model and Generating reconstructed samples
* To save the reconstructed samples in excel file:  
```python
python data_preprocessing.py --path "dataset.xlsx" --bsize 64

python reconstruct.py --bsize 64 --epochs 1000 --gensamples 20 --output_format "xlsx"
```
* To save the reconstructed samples as csv file:
```python
python data_preprocessing.py --path "dataset.xlsx" --bsize 64

python reconstruct.py --bsize 64 --epochs 1000 --gensamples 20 --output_format "csv"
```

**Note:** The above command performs training of the model and generates reconstructed samples from the decoder part of the VAE in an excel file with name `reconstruct.xlsx` or `reconstruct.csv` if you choose the output_format as `csv`. Default output format is `xlsx`.  

* For more help on how to use the model with different hyperparameters: 

```python
python train_model.py -h
```

### Example comparison of the original sample and reconstructed samples generated by VAE
* Original data excel sheet
![original sample](images/original_sample.png)
* Reconstructed excel sheet
![reconstructed sample](images/reconstructed_sample.png)


### References: 

```
sayantan.k (2022) NormVAE: Normative modelling on neuroimaging data using Variational Autoencoders, arXiv:2110.04903v2 [eess.IV] 30 Jan 2022
```
